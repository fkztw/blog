<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>  MySQL client 預設允許 MySQL Server 讀取本地端的檔案
 | Just for noting</title>

    <meta name="author" content="fkz"/>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"/>
    <link rel="stylesheet" href="https://blog.fkz.tw/theme/css/jquery.mglass.css"/>
    <link rel="stylesheet" href="https://blog.fkz.tw/theme/css/pygment-solarized-dark.css"/>
    <link rel="stylesheet" href="https://blog.fkz.tw/theme/css/style.css"/>

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Istok+Web' rel='stylesheet' type='text/css'/>
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'/>


    <link rel="icon" href="https://blog.fkz.tw/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="https://blog.fkz.tw/favicon.ico" type="image/x-icon">

    <!-- Feeds -->
      <link href="https://blog.fkz.tw/feeds/all.feed.atom.xml" type="application/atom+xml" rel="alternate" title="Just for noting - All posts - Atom Feed"/>
      <link href="https://blog.fkz.tw/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Just for noting - Latest posts - Atom Feed"/>
      <link href="https://blog.fkz.tw/feeds/category.note.atom.xml" type="application/atom+xml" rel="alternate" title="Just for noting - Category: Note - Atom Feed"/>

    <script type="text/javascript">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-45367183-2', 'auto');
    ga('send', 'pageview');
    </script>



  </head>

  <body>

    <div class="container">

      <div class="page-header">
        <h1><a href="https://blog.fkz.tw">Just for noting</a> <small></small></h1>
      </div>

      <nav class="navbar navbar-default">

        <!-- Hamburger menu for mobile -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#plumage-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="https://blog.fkz.tw" title="">Just for noting</a>
        </div>

        <!-- Menus and search forms -->
        <div class="collapse navbar-collapse" id="plumage-navbar-collapse-1">

          <ul class="nav navbar-nav">
<li >
                <a href="/categories">Categories</a>
              </li>
<li >
                <a href="/archives">Archives</a>
              </li>
<li >
                <a href="/tags">Tags</a>
              </li>
          </ul>


            <form class="navbar-form navbar-right" role="search" action="https://blog.fkz.tw/search.html" onsubmit="return validateForm(this.elements['q'].value);">
              <div class="form-group">
                <div class="input-group">
                  <input type="text" name="q" id="tipue_search_input" class="form-control search-query" placeholder="Search" required />
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa
                        fa-search fa-fw"></i></button>
                  </span>
                </div>
              </div>
            </form>

        </div>

      </nav>

    </div>


    <div class="container main">


      <div class="row">
        <div class=" col-md-9  ">
  <h1>
    <a href="https://blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/" rel="bookmark" title="Permalink to MySQL client 預設允許 MySQL Server 讀取本地端的檔案">MySQL client 預設允許 MySQL Server 讀取本地端的檔案</a>
  </h1>
        </div>
      </div>

      <div class="row">


        <div class=" col-md-9 " id="content" role="main">
  

  <blockquote>
    <p>MySQL 的協定在設計上有瑕疵，導致了一些安全性問題。</p>
  </blockquote>
  <div>
    <p>這篇算是個翻譯兼摘要文，<br>
今天看到原文覺得有趣就追了一下，<br>
原文在此：<a href="https://gwillem.gitlab.io/2019/01/20/sites-hacked-via-mysql-protocal-flaw/">MySQL client allows MySQL server to request any local file</a>  </p>
<hr>
<h2>TL;DR</h2>
<p>MySQL 協定上的瑕疵<br>
預設讓 Server 可以讀取 Client 上有讀取權限的所有資料<br>
導致有心人士可以寫一個加了點料的 MySQL server<br>
當你連上它的時候你的東西就被它看光光了  </p>
<ul>
<li>原因：mysql-client 的 <code>LOAD DATA LOCAL</code> 預設是 Enable  </li>
<li>解法：記得改成 Disable  </li>
<li>官方文件：<a href="https://dev.mysql.com/doc/refman/8.0/en/load-data-local.html">https://dev.mysql.com/doc/refman/8.0/en/load-data-local.html</a>  </li>
</ul>
<p><a href="https://twitter.com/ColeWippern/status/1086974610246193152">目前據報 mysql-client 8.0 預設沒這問題，因為 <code>LOAD DATA LOCAL</code> 預設是 Disable 的。但 5.5, 5.6, 5.7 預設都是 Enable 的。</a>  </p>
<p>有些 ORM framework 預設是有幫忙 Disable <code>LOAD DATA LOCAL</code> 的，但不是每個都有，開發者要注意一下。  </p>
<hr>
<h2>玩法</h2>
<ol>
<li>
<p>攻擊執行了 Adminer 的網站  </p>
<ul>
<li>黑帽架一個 Evil MySQL Server  <ul>
<li>這裡有個 5 年多前就出現的範例程式：<a href="https://github.com/Gifts/Rogue-MySql-Server/blob/master/rogue_mysql_server.py">https://github.com/Gifts/Rogue-MySql-Server/blob/master/rogue_mysql_server.py</a>  </li>
</ul>
</li>
<li>找到某個網站公開的 <code>adminer.php</code>  </li>
<li>讓 Adminer 去連接黑帽架設的 Evil MySQL Server  <ul>
<li>Adminer 預設沒 Disable <code>LOAD DATA LOCAL</code>  </li>
<li>Adminer 其中一個功能就是讓你可以連接外部的 MySQL Server  </li>
</ul>
</li>
<li>黑帽就可以開心的讀取到你伺服器上的各種資料了  </li>
<li>原作者的另一篇文章有詳細講 Adminer 被攻擊的步驟  <ul>
<li><a href="https://gwillem.gitlab.io/2019/01/17/adminer-4.6.2-file-disclosure-vulnerability/">https://gwillem.gitlab.io/2019/01/17/adminer-4.6.2-file-disclosure-vulnerability/</a>  </li>
</ul>
</li>
<li>Adminer 升級到 4.7.0 可以避免掉這個問題  </li>
</ul>
</li>
<li>
<p>Honeypot  </p>
<ul>
<li>架個公開的 Evil MySQL Server  </li>
<li>嘗試讀取上鉤的攻擊者的檔案  <ul>
<li>如果他用來連線的 mysql-client 也沒把 <code>LOAD DATA LOCAL</code> 關掉就會中招。  </li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h2>相關討論</h2>
<p>可能會有後續發展可以追  </p>
<ul>
<li><a href="https://mobile.twitter.com/gwillem/status/1086275952915533828">https://mobile.twitter.com/gwillem/status/1086275952915533828</a>  </li>
<li><a href="https://www.reddit.com/r/programming/comments/ahspfv/mysql_client_allows_mysql_server_to_request_any/">MySQL client allows MySQL server to request any local file by default : programming</a>  </li>
<li>結果後來原作者得知有其他人在去年 8 月就寫了一樣的東西了，而且還有精美的圖文 writeup。  <ul>
<li><a href="https://medium.com/bugbountywriteup/adminer-script-results-to-pwning-server-private-bug-bounty-program-fe6d8a43fe6f">Adminer Script Results to Pwning Server?, Private Bug Bounty Program</a>  </li>
</ul>
</li>
</ul>
<hr>
<h2>References</h2>
<ul>
<li><a href="https://gwillem.gitlab.io/2019/01/20/sites-hacked-via-mysql-protocal-flaw/">MySQL client allows MySQL server to request any local file</a>  </li>
<li><a href="https://medium.com/bugbountywriteup/adminer-script-results-to-pwning-server-private-bug-bounty-program-fe6d8a43fe6f">Adminer Script Results to Pwning Server?, Private Bug Bounty Program</a>  </li>
</ul>
  </div>

    <hr>
    <section>
        <p id="post-share-links">
            <h3>Share</h3>
            <a href="https://twitter.com/intent/tweet?text=MySQL%20client%20%E9%A0%90%E8%A8%AD%E5%85%81%E8%A8%B1%20MySQL%20Server%20%E8%AE%80%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%AB%AF%E7%9A%84%E6%AA%94%E6%A1%88%0Ahttps%3A//blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/%0Avia%20%40M157q%0A" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square fa-3x"></i></a>
            <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=https%3A//blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square fa-3x"></i></a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/&title=MySQL%20client%20%E9%A0%90%E8%A8%AD%E5%85%81%E8%A8%B1%20MySQL%20Server%20%E8%AE%80%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%AB%AF%E7%9A%84%E6%AA%94%E6%A1%88&summary=MySQL%20%E7%9A%84%E5%8D%94%E5%AE%9A%E5%9C%A8%E8%A8%AD%E8%A8%88%E4%B8%8A%E6%9C%89%E7%91%95%E7%96%B5%EF%BC%8C%E5%B0%8E%E8%87%B4%E4%BA%86%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E6%80%A7%E5%95%8F%E9%A1%8C%E3%80%82&source=https%3A//blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/" target="_blank" title="Share on LinkedIn"><i class="fa fa-linkedin-square fa-3x"></i></a>
            <a href="mailto:?subject=MySQL%20client%20%E9%A0%90%E8%A8%AD%E5%85%81%E8%A8%B1%20MySQL%20Server%20%E8%AE%80%E5%8F%96%E6%9C%AC%E5%9C%B0%E7%AB%AF%E7%9A%84%E6%AA%94%E6%A1%88&amp;body=https%3A//blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/" target="_blank" title="Share via Email"><i class="fa fa-envelope-o fa-3x"></i></a>
        </p>
    </section>

<hr>
<section id="donation">
    <h3>Donation</h3>
    <p id="donation-chinese">
      如果覺得這篇文章對你有幫助，
      除了留言讓我知道外，
      或許也可以考慮請我喝杯咖啡，
      不論金額多寡我都會非常感激且能鼓勵我繼續寫出對你有幫助的文章。
    </p>
    <p id="donation-english">
      If this blog post happens to be helpful to you, besides of leaving a reply, you may consider buy me a cup of coffee to support me. It would help me write more articles helpful to you in the future and I would really appreciate it.
    </p>
    <ul id="donation-address">
			<li><a href="https://payment.opay.tw/Broadcaster/Donate/4E163AAE10E448A30DB244CF85527271">歐付寶</a></li>

        <li><a href="https://buymeacoffee.com/M157q">Buy Me a Coffee</a></li>


			<li>BTC: <a href="https://blockchain.info/address/3QZy3cHvoZcszuqWK5CdCutLEJLeAX5ip6">3QZy3cHvoZcszuqWK5CdCutLEJLeAX5ip6</a></li>

			<li>USDT Omni: <a href="https://blockchain.info/address/3QZy3cHvoZcszuqWK5CdCutLEJLeAX5ip6">3QZy3cHvoZcszuqWK5CdCutLEJLeAX5ip6</a></li>

			<li>ETH: <a href="https://etherscan.io/address/0x926bf92b29de4C6E15CbCE99e0a7aB053877181b">0x926bf92b29de4C6E15CbCE99e0a7aB053877181b</a></li>

			<li>USDT ERC20: <a href="https://etherscan.io/address/0x926bf92b29de4C6E15CbCE99e0a7aB053877181b">0x926bf92b29de4C6E15CbCE99e0a7aB053877181b</a></li>

			<li>DAI: <a href="https://etherscan.io/address/0x926bf92b29de4C6E15CbCE99e0a7aB053877181b">0x926bf92b29de4C6E15CbCE99e0a7aB053877181b</a></li>

			<li>LTC: <a href="https://chainz.cryptoid.info/ltc/address.dws?MD26bUR4VsykGp8Ky2QbstejoFGJaj3hpM.htm">MD26bUR4VsykGp8Ky2QbstejoFGJaj3hpM</a></li>
    </ul>
</section>

    <hr>
    <h3>Related Posts</h3>
    <!-- TODO: Use fancier related layout, as in http://kevin.deldycke.com/2012/04/beautify-contextual-related-posts-wordpress-plugin/ -->
    <ul>
        <li><a href="https://blog.fkz.tw/posts/2017/09/04/y2017w35/">Y2017W35</a></li>
        <li><a href="https://blog.fkz.tw/posts/2017/08/07/y2017w31/">Y2017W31</a></li>
        <li><a href="https://blog.fkz.tw/posts/2016/09/19/cve-2016-2662/">CVE-2016-2662</a></li>
        <li><a href="https://blog.fkz.tw/posts/2016/11/07/y2016w44/">Y2016W44</a></li>
        <li><a href="https://blog.fkz.tw/posts/2015/10/19/hitcon-ctf-2015-quals-write-up/">HITCON CTF 2015 Quals Write-up</a></li>
      </ul>

    <div class="comments">
      <div id="disqus_thread"></div>
	  <script type="text/javascript">
        var disqus_shortname = 'fkz-logdown';
        var disqus_identifier = "posts/2019/01/22/mysql-protocol-flaw/";
        var disqus_title = "MySQL client 預設允許 MySQL Server 讀取本地端的檔案";
        var disqus_url = "https://blog.fkz.tw/posts/2019/01/22/mysql-protocol-flaw/";

        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
        };
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>
    </div>

        </div>

          <div class="col-md-3">
  <div class="well">

    <p><abbr title="2019-01-22T03:17:54+08:00"><i class="fa fa-calendar"></i> Tue 22 January 2019</abbr></p>

      <p><abbr title="2019-01-22T03:29:54+08:00"><i class="fa fa-pencil"></i>Tue 22 January 2019</abbr></p>

      <p><address>
        <i class="fa fa-user"></i> By
          <a href="https://blog.fkz.tw/author/fkz.html" rel="author">fkz</a>
      </address></p>

    <hr/>

      <p>
              <p>
              <a href="https://blog.fkz.tw/category/note/" rel="tag"
                  data-toggle="tooltip"
                  class="label label-info"
                  title="142 articles in this category">Note</a>
              </p>
            <a href="/tag/security/" data-toggle="tooltip"
      class="label label-default"
      title="55 articles with this tag">security</a>
  <br>
            <a href="/tag/mysql/" data-toggle="tooltip"
      class="label label-default"
      title="9 articles with this tag">MySQL</a>
  <br>
      </p>
      <hr/>


      <nav>
        <ul class="pager">
          <li class="previous ">
            <a  href="https://blog.fkz.tw/posts/2018/10/11/taipei-blockchain-meetup-20181011/" title="Taipei Blockchain Meetup 20181011"  rel="prev">
              <span aria-hidden="true">←</span> Older
            </a>
          </li>
          <li class="next ">
            <a  href="https://blog.fkz.tw/posts/2019/12/19/child-and-adult/" title="小孩與大人"  rel="next">
              Newer <span aria-hidden="true">→</span>
            </a>
          </li>
        </ul>
      </nav>

  </div>
            
          </div>

      </div>

    </div>

    <!-- TODO: make footer sticky -->
    <footer class="container-fluid">
      <div class="container">
        <div class="row">

            <div class="col-md-2">
                <h5>Social</h5>
                <ul class="list-unstyled">
                  <li>  <a href="https://github.com/M157q">
      <i class="fa fa-github"></i>
    GitHub
  </a></li>
                  <li>  <a href="https://twitter.com/M157q">
      <i class="fa fa-twitter"></i>
    Twitter
  </a></li>
                </ul>
            </div>
            <div class="col-md-2">
                <h5>Links</h5>
                <ul class="list-unstyled">
                  <li>  <a href="http://getpelican.com/">
      <img src="https://www.google.com/s2/favicons?domain=getpelican.com" width="16" height="16" class="icon" alt="getpelican.com icon"/>
    Pelican
  </a></li>
                  <li>  <a href="http://python.org/">
      <img src="https://www.google.com/s2/favicons?domain=python.org" width="16" height="16" class="icon" alt="python.org icon"/>
    Python.org
  </a></li>
                  <li>  <a href="http://jinja.pocoo.org/">
      <img src="https://www.google.com/s2/favicons?domain=jinja.pocoo.org" width="16" height="16" class="icon" alt="jinja.pocoo.org icon"/>
    Jinja2
  </a></li>
                </ul>
            </div>

          <div class="col-md-2">
            <h5>Browse content by</h5>
            <ul class="list-unstyled">
                <li><a href="https://blog.fkz.tw/categories/index.html"><i class="fa fa-tags"></i> Categories</a></li>
                <li><a href="https://blog.fkz.tw/archives/index.html"><i class="fa fa-calendar"></i> Dates</a></li>
                <li><a href="https://blog.fkz.tw/tags/index.html"><i class="fa fa-tag"></i> Tags</a></li>
            </ul>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Copyright notice</h5>
            <p>© Copyright 2013-2022 fkz.</p>
          </div>

          <div class="col-md-2 text-muted">
            <h5>Disclaimer</h5>
              <p>All opinions expressed in this site are my own personal opinions and are not endorsed by, nor do they represent the opinions of my previous, current and future employers or any of its affiliates, partners or customers.</p>
          </div>

          <div class="col-md-2">
              <h5>Feeds</h5>
              <ul class="list-unstyled">
                  <li><small><a href="https://blog.fkz.tw/feeds/all.feed.atom.xml"><i class="fa fa-rss"></i> All posts (Atom)</a></small></li>
                  <li><small><a href="https://blog.fkz.tw/feeds/atom.xml"><i class="fa fa-rss"></i> Latest posts (Atom)</a></small></li>
                  <li><small><a href="https://blog.fkz.tw/feeds/category.note.atom.xml"><i class="fa fa-rss"></i> Category: Note (Atom)</a></small></li>
              </ul>
          </div>

        </div>
      </div>

      <h5 class="text-right"><a href="#"><i class="fa fa-arrow-up"></i> Back to top</a></h5>

      <div class="container">
        <div class="row col-md-12 text-muted text-center">
          Site generated by <a href="https://getpelican.com"> Pelican</a>.<br/>
          <a href="https://github.com/kdeldycke/plumage"> Plumage</a> theme by <a href="https://kevin.deldycke.com">Kevin Deldycke</a>.
        </div>
      </div>

    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="https://blog.fkz.tw/theme/js/jquery.mglass.js"></script>
    <script src="https://blog.fkz.tw/theme/js/application.js"></script>

  </body>
</html>